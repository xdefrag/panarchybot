# Создание аккаунта

## Триггеры
- Команда `/start` для новых пользователей
- Прямое обращение к боту без существующего аккаунта

## Технический процесс

### 1. Проверка существования аккаунта
- Проверка наличия записи в базе данных для текущего Telegram ID
- Если аккаунт существует, показываем приветственное сообщение с текущим балансом

### 2. Генерация ключей Stellar
- Использование `stellar-sdk` для создания новой пары ключей
- Публичный ключ (public key) - адрес аккаунта
- Приватный ключ (secret key) - для подписи транзакций
- Шифрование приватного ключа перед сохранением в базу данных

### 3. Создание аккаунта в сети Stellar
- Подключение к сети Stellar (testnet/mainnet в зависимости от конфигурации)
- Создание транзакции CreateAccount
- Начальное пополнение аккаунта минимальным балансом (1 XLM для резерва)
- Подписание транзакции
- Отправка транзакции в сеть
- Ожидание подтверждения транзакции

### 4. Сохранение данных
- Запись в базу данных:
  - Telegram ID пользователя
  - Username пользователя
  - Публичный ключ Stellar
  - Зашифрованный приватный ключ
  - Временная метка создания
  - Статус аккаунта

### 5. Настройка доверенных активов (trustlines)
- Создание trustline для основных активов системы
- Каждый trustline требует отдельной транзакции
- Увеличение резерва XLM для каждого trustline

### 6. Ответ пользователю
- Отправка сообщения с подтверждением создания аккаунта
- Предоставление публичного ключа
- Инструкции по использованию бота
- Текущий баланс аккаунта

## Обработка ошибок
- Недостаточно XLM для создания аккаунта
- Ошибки сети Stellar
- Дупликаты аккаунтов
- Проблемы с шифрованием/дешифрованием ключей
- Ошибки базы данных

## Безопасность
- Приватные ключи никогда не отправляются пользователю
- Шифрование приватных ключей в базе данных
- Проверка прав доступа для команд управления
- Ограничение количества попыток создания аккаунта
- Защита от спама и атак 
# Проверка баланса

## Триггеры
- Команда `/balance`
- Автоматическая проверка после операций с активами
- Периодическая проверка для мониторинга

## Технический процесс

### 1. Получение данных аккаунта
- Получение публичного ключа пользователя из базы данных по Telegram ID
- Проверка существования аккаунта в сети Stellar
- Получение всех балансов и trustlines аккаунта

### 2. Запрос к сети Stellar
- Использование Horizon API для получения данных аккаунта
- Получение списка всех активов на балансе
- Для каждого актива:
  - Код актива
  - Эмитент
  - Доступный баланс
  - Зарезервированные средства
  - Лимиты trustline

### 3. Обработка данных
- Фильтрация активов с нулевым балансом (опционально)
- Конвертация значений в человекочитаемый формат
- Группировка активов по типам
- Расчет эквивалента в фиатной валюте (если настроено)

### 4. Форматирование ответа
- Создание структурированного сообщения
- Добавление информации о:
  - Нативном балансе (XLM)
  - Балансах других активов
  - Доступных лимитах
  - Зарезервированных средствах
- Добавление кнопок для действий с активами

## Обработка ошибок
- Аккаунт не найден в базе данных
- Ошибки сети Stellar
- Проблемы с получением курсов конвертации
- Таймауты запросов

## Оптимизация
- Кэширование балансов
- Ограничение частоты запросов
- Batch-запросы для множественных проверок
- Асинхронное обновление курсов конвертации 
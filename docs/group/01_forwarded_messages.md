# Обработка пересылаемых сообщений

## Триггеры
- Пересылаемое сообщение из основного канала в группу
- Проверка `MessageOriginChannel` и соответствия ID канала

## Технический процесс

### 1. Проверка источника
- Проверка наличия поля `ForwardOrigin`
- Проверка типа источника (`MessageOriginChannel`)
- Валидация ID канала с конфигурацией (`MainChannelID`)
- Проверка прав доступа

### 2. Обработка сообщения
- Получение контекста сообщения
- Анализ содержимого
- Сохранение метаданных
- Подготовка ответа

### 3. Интеграция с кампаниями
- Проверка активных кампаний
- Применение правил кампании
- Обработка специальных условий
- Сохранение статистики

### 4. Взаимодействие с ChatGPT
- Анализ контекста
- Генерация релевантных ответов
- Обработка результатов
- Форматирование ответа

## Обработка ошибок
- Неверный формат сообщения
- Ошибки доступа
- Проблемы с API ChatGPT
- Ошибки кампаний
- Системные ошибки

## Безопасность
- Проверка прав доступа
- Валидация источника
- Защита от спама
- Мониторинг активности
- Логирование действий

## Метрики
- Количество обработанных сообщений
- Время обработки
- Успешность операций
- Статистика ошибок
- Активность пользователей 